# 【八股】JVM

## 一、内存区域与对象

### 1、Java 的运行时内存区域划分了几块？分别有什么作用？哪些是线程私有的？

一共有五个部分，分别是：

- **程序计数器**
  - 可看作当前线程所执行的字节码的行号指示器，用来控制程序执行流程，如分支、跳转、循环等
  - 线程私有
  - 不会报 OutOfMemoryError
  
- **Java 虚拟机栈**
  
  - 指的是 Java 方法执行的线程内存模型。每个方法被执行的时候，JVM 会同步创建一个栈帧，用于存储局部变量表、操作数栈、动态链接和方法出口等信息。每个方法被调用时入栈，执行完毕后出栈。
  - 线程私有
  - 栈不够深会报 StackOverflowError，栈不够内存扩展会报 OutOfMemoryError
  
- **本地方法栈**
  - 与 Java 虚拟机栈相似，不同之处在于虚拟机栈是为执行的 Java 方法服务；而本地方法栈是为虚拟机使用到的本地方法服务
  - 本地方法：`Object` 类的 `hashCode()`
  - 线程私有
  
- **Java 堆**
  - 用于存放对象实例
  - 共享内存区域
  - 垃圾收集器管理的内存区域
  - 堆无法扩展时，会报 OutOfMemoryError
  
- **方法区**
  - 用于存储已被虚拟机加载的类型信息、常量、静态变量等数据
  - 共享内存区域
  - 可以被垃圾收集器管理：常量池回收和类型的卸载
  - 注意：在 JAVA8 之前，是通过永久代实现；**在 JAVA8 后，是在本机内存中的元空间实现**
  
  ![image-20230306110558577](./【八股】JVM.assets/image-20230306110558577.png)

### 2、运行时常量池在内存中的哪里？能否在运行期间加入新的常量？

运行时常量池在 **方法区** 中。具体过程：

- 在进行编译的过程中，会将产生的 **字面量、符号引用** 等信息记录为 **常量池表**，存在 Class 文件中
- 当类加载后，常量池表的内容就放入 **方法区的运行时常量池** 中

运行时常量池的特点就是 **动态性** ！能够支持运行期间加入新的常量，如使用 `String#intern()` 方法。

### 3、常量池在内存中吗？

是的，在 Java 中，常量池是一块位于内存中的特殊区域。

在 Java 虚拟机中，**常量池被存储在方法区的永久代（对于JDK 7及以下版本）或元空间（对于JDK 8及以上版本）** 中，它包含了类中使用的所有字面量常量和符号引用。

在 Java 程序中，可以使用关键字"final"来定义常量。在编译时，Java 编译器会将这些常量的值存储在常量池中。当程序运行时，如果需要使用这些常量，虚拟机会从常量池中获取它们的值，而不是重新创建一个对象。

需要注意的是，常量池中的常量是不可变的。如果程序尝试修改一个常量池中的值，会导致编译错误或运行时异常。

### 4、StringTable存放在哪？

StringTable 是 Java 虚拟机中的一种数据结构，**它用于存储 字符串常量池 中的字符串对象** 。在 Java 虚拟机中，**StringTable 被存储在堆内存中，而不是方法区或元空间中。**

在 Java 程序中，字符串常量池中的字符串对象是一种特殊的对象，它们在程序中被频繁使用。为了提高程序的性能，Java 虚拟机使用了 StringTable 这种数据结构来缓存这些字符串对象。当程序需要使用一个字符串对象时，虚拟机会先在 StringTable 中查找该字符串对象，如果存在则直接返回它的引用，否则会创建一个新的字符串对象并将其添加到 StringTable 中。

需要注意的是，在JDK 7及以下版本中，StringTable 是位于方法区中的。而在 **JDK 8 及以上版本中，StringTable 被移动到堆内存中，以便更好地进行垃圾回收** 。虽然 StringTable 被存储在堆内存中，但它并不是普通的 Java 对象，而是由 Java 虚拟机内部实现的一种数据结构。

### 5、Integer等包装类的常量池存放在哪？

**Integer 等包装类的常量池存储在 Java 虚拟机的 方法区 中**。

**在 Java 8 及之前版本中，Integer 类维护了一个缓存区，用于存储在 -128 到 127 之间的整数对象**，这些整数对象是提前创建好的。在需要使用这些整数对象时，会直接从缓存区获取。这个缓存区存储在 IntegerCache 类中，也是存储在方法区中的。而在**Java 9中，这个缓存区被移除，因此 Integer 类中的整数对象都是动态创建的。**

## 二、垃圾收集

### 1、Java中的四种引用类型？区别？

四种引用类型：



### 2、如何判断一个对象是否该被垃圾收集？



### 3、常见的垃圾收集算法有哪些？



### 4、常见的垃圾收集器有哪些？



### 5、G1垃圾收集器



## 三、类加载与类加载器

### 1、描述一下类加载的过程？类的生命周期？



### 2、什么是符号引用和直接引用？



### 3、常见的类加载器？



### 4、什么是双亲委派模型？









